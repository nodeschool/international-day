<!DOCTYPE html>
<html ng-app='myApp' lang="en">

<head>
  <title>NodeSchool International Day - 2016</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
  <link type="text/css" rel="stylesheet" href="css/style.css" media="screen,projection" />
</head>

<body>
  <section id="banner">
    <a href="http://nodeschool.io/" class="hoverable"><img src="images/international-day-logo.png" alt="International Day Logo"></a>
    <h3>International Day</h3>
    <time datetime="2016-05-21">Saturday, May 21, 2016</time>
  </section>
  <nav class="light-blue" role="navigation" id="navigation">
    <div class="nav-wrapper container">
      <a href="#" data-activates="mobile-menu" class="button-collapse"><i class="material-icons">menu</i></a>
      <ul class="left hide-on-med-and-down">
        <li><a href="https://github.com/nodeschool/international-day" target="_blank">Github<img src="images/github.png" alt="" class="social-icon" /></a></li>
        <li><a href="https://gitter.im/nodeschool/international-day" target="_blank"><i class="material-icons right">chat</i>Gitter</a></li>
        <li><a href="http://lulusam.github.io/nodeschoolstream/" target="_blank"><i class="material-icons right">
        cast</i>Live Stream</a></li>
      </ul>
      <ul class="right hide-on-med-and-down">
        <li><a href="https://drive.google.com/folderview?id=0B1E3fBFiidMXLWhuaWU1TUM5Rmc&usp=sharing" target="_blank"><i class="material-icons right">backup</i>Upload Media</a></li>
        <li><a href="http://goo.gl/forms/7jB01kGihs" target="_blank"><i class="material-icons right">feedback</i>2016 Feedback</a></li>
      </ul>
      <ul class="side-nav" id="mobile-menu">
        <li><a href="https://github.com/nodeschool/international-day" target="_blank">Github<img src="images/github-dark.png" alt="" class="social-icon" /></a></li>
        <li><a href="https://gitter.im/nodeschool/international-day" target="_blank"><i class="material-icons right">chat</i>Gitter</a></li>
        <li><a href="http://lulusam.github.io/nodeschoolstream/" target="_blank"><i class="material-icons right">
        cast</i>Live Stream</a></li>
        <li><a href="https://drive.google.com/folderview?id=0B1E3fBFiidMXLWhuaWU1TUM5Rmc&usp=sharing" target="_blank"><i class="material-icons right">backup</i>Upload Media</a></li>
        <li><a href="http://goo.gl/forms/7jB01kGihs" target="_blank"><i class="material-icons right">feedback</i>2016 Feedback</a></li>
      </ul>
    </div>
  </nav>
  <div class="section no-pad-bot" id="description">
    <div class="container">
      <br>
      <div class="row center">
        <h5 class="header col s12 light">Over 24 hours, the <a href="http://nodeschool.io/" class="black-text">NodeSchool</a> community will come together and organize NodeSchool events all around the globe. <a href="https://twitter.com/search?q=%23nodeschoolday" target="_blank">#nodeschoolday</a></h5>
      </div>
    </div>
  </div>
  <div class="container" id="info">
    <div class="section">
      <div class="row">
        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center light-blue-text"><i class="material-icons medium">face</i></h2>
            <h5 class="center">Interested in attending?</h5>
            <p class="light">The chapter logos below show who is currently enrolled and provide links to the event sign up pages.</p>
          </div>
        </div>
        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center light-blue-text"><i class="material-icons medium">event</i></h2>
            <h5 class="center">Organising an event?</h5>
            <p class="light">Please read the <a href="https://github.com/nodeschool/international-day/blob/2015/PARTICIPATING.md" class="black-text" target="_blank">guide</a> to get the most out of the day.</p>
          </div>
        </div>
        <div class="col s12 m4">
          <div class="icon-block">
            <h2 class="center light-blue-text"><i class="material-icons medium">star</i></h2>
            <h5 class="center">Get involved!</h5>
            <p class="light">Find out how <a href="https://github.com/nodeschool/international-day/issues" class="text-black" target="_blank">in our issue tracker</a> and follow us on <a href="http://twitter.com/nodeschool/" class="text-black" target="_blank">twitter</a>.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="section" id="chapters">
      Loading...
    </div>
  </div>

  <footer class="row page-footer no-pad-bot yellow darken-1" id="footer">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="black-text">About NodeSchool</h5>
          <p class="black-text">Open source workshops that teach web software skills. Do them on your own or at a workshop nearby.</p>
        </div>
        <div class="col l3 s12">
          <h5 class="black-text">Connect</h5>
          <ul>
            <li>
              <a class="black-text" href="https://github.com/nodeschool/international-day" target="_blank"><img src="" alt="" />Github</a>
            </li>
            <li><a class="black-text" href="https://twitter.com/nodeschool" target="_blank">Twitter</a></li>
            <li><a class="black-text" href="http://gitter.im/nodeschool/international-day" target="_blank">Gitter</a></li>
            <li><a class="black-text" href="http://lulusam.github.io/nodeschoolstream/" target="_blank">Live Stream</a></li>
          </ul>
        </div>
        <div class="col l3 s12">
          <h5 class="black-text">Resources</h5>
          <ul>
            <li><a class="black-text" href="https://github.com/nodeschool/international-day/blob/2016/code_of_conduct_en.md" target="_blank">Code of Conduct</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <!-- Compiled and minified JavaScript -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="http://momentjs.com/downloads/moment.min.js"></script>
  <script src="http://momentjs.com/downloads/moment-timezone-with-data.js"></script>
  <script type="text/javascript" src="js/tabletop.js"></script>

  <!-- Necessary for the side-nav menu on mobile -->
  <script type="text/javascript">
    $(document).ready(function() {
      $(".button-collapse").sideNav();
    });

    function fixTime (value) {
      if (/^[0-9]\:/.test(value)) {
        value = '0' + value
      }
      if (/PM/.test(value)) {
        var valueParts = value.split(':')
        var pmTime = parseInt(valueParts[0], 10)
        if (pmTime !== 12) {
          valueParts[0] =  + 12 
        }
        value = valueParts.join(':')
      }
      value = value.replace(/(A|P)M/, '')
      value = '2016-05-21 ' + value
      return value
    }

    var iconLookup = {
      bainbridge: 1,
      barcelona: 1,
      belgrade: 1,
      bengaluru: 1,
      berlin: 1,
      buenosaires: 1,
      costarica: 1,
      dhaka: 1,
      hermosillo: 1,
      kolkata: 1,
      italy: 1,
      lahore: 1,
      lisbon: 1,
      london: 1,
      manizales: 1,
      mexicocity: 1,
      newyork: 1,
      oakland: 1,
      osaka: 1,
      pereira: 1,
      raleigh: 1,
      reykjavik: 1,
      sanfrancisco: 1,
      tacoma: 1,
      tokyo: 1,
      toronto: 1,
      vancouver: 1,
      washingtondc: 1,
      westernmass: 1,
      zagreb: 1
    }

    Tabletop.init( {
      key: '1XHEtzfLpixcQpogVzNdm-sVVqw4YHJ1IBllCk5H9oyc',
      callback: function(data, tabletop) {
        $chapters = $('#chapters').empty()
        var form = data['Form Responses 1']
        var column_names = form.column_names.reduce(function (names, name, nr) {
          names[name] = nr
          return names
        }, {})
        var lines = form.elements
        var chapters = lines
          .map(function (line) {
            var result = {}
            for (var name in line) {
              var key = column_names[name]
              if (typeof key !== 'undefined') {
                result[key] = line[name]
              }
            }
            return result
          })
          .filter(function (line) {
            // Cancelled
            return line[21] !== 'Yes'
          })
          .map(function (line) {
            var tz = line[8]
            return {
              name: line[1],
              url: line[2],
              icon: line[3],
              signupURL: line[4],
              _start: line[6],
              start: moment.tz(fixTime(line[6]), tz),
              _end: line[7],
              end: moment.tz(fixTime(line[7]), tz),
              tz: tz
            }
          })
          .map(function (chapter) {
            var normalizedName = chapter.name.toLowerCase().replace(/ /g, '')
            if (iconLookup[normalizedName]) {
              chapter.icon = 'images/icn-' + normalizedName + '.png'
            }
            return chapter
          })
          .sort(function (a, b) {
            var aVal = a.start.valueOf()
            var bVal = b.start.valueOf()
            if (aVal > bVal) {
              return 1
            }
            if (aVal < bVal) {
              return -1
            }
            return 0
          })
        chapters.map(function (chapter) {
            return $('<div class="col s12 m3" ng-repeat="chapter in row">' +
              '  <a href="' + chapter.signupURL + '" class="black-text" target="_blank">' +
              '    <div class="card center hoverable">' +
              '      <div class="card-content">' +
              '        <h5 class="card-title">' + chapter.name + '</h5>' +
              '        <img class="chapter-logo" src="' + chapter.icon + '" alt="Nodeschool ' + chapter.name + ' Logo">' +
              '      </div>' +
              '      <div class="card-action center">' +
              '        <span>Sign Up!</span>' +
              '        <div class="time"></div>' + 
              '      </div>' +
              '    </div>' +
              '  </a>' +
              '</div>')
          })
          .reduce(function (rows, $chapter, nr) {
            var key = 'row' + (((nr / 4) | 0) + 1)
            var $row = rows[key]
            if (!$row) {
              $row = rows[key] = $('<div class="row"></div>')
              $row.appendTo($chapters)
            }
            $row.append($chapter)
            return rows
          }, {})

        $time = $('.time').toArray().map(function (node) {
          return $(node)
        })
        function updateTimeDisplay() {
          $time.forEach(function (node, nr) {
            var chapter = chapters[nr]
            var state = 'future'
            var ended = chapter.end.fromNow()
            var waiting = chapter.start.fromNow()
            if (chapter.end < Date.now()) {
              state = 'past'
            } else if (chapter.start < Date.now()) {
              state = 'now'
            }
            node
              .toggleClass('now', state === 'now')
              .toggleClass('past', state === 'past')
              .toggleClass('future', state === 'future')

            if (state === 'future') {
              node.text('The event starts ' + waiting)
            } else if (state === 'past') {
              node.text('The event has ended ' + ended)
            } else {
              node.text('Now happening!')
            }
          })
        }
        setInterval(updateTimeDisplay, 1000)
        updateTimeDisplay()
      }
    })
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
</body>

</html>
